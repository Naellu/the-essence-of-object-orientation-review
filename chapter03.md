# 03. 타입과 추상화

|chapter|                                                     name                                                     |
|:---|:------------------------------------------------------------------------------------------------------------:|
| 1장 | [협력하는 객체들의 공동체](https://github.com/Naellu/the-essence-of-object-orientation-review/blob/master/chapter01.md) |
| 2장 |  [이상한 나라의 객체](https://github.com/Naellu/the-essence-of-object-orientation-review/blob/master/chapter02.md)   |
| **3장** |    [타입과 추상화](https://github.com/Naellu/the-essence-of-object-orientation-review/blob/master/chapter03.md)    |  
| 4장 |  [역할, 책임, 협력](https://github.com/Naellu/the-essence-of-object-orientation-review/blob/master/chapter04.md)   |

<br>

> 일단 컴퓨터를 조작하는 것이 추상화를 구축하고, 조작하고, 추론하는 것에 관한 모든 것이라는 것을 깨닫고 나면  
> (훌륭한)컴퓨터 프로그램을 작성하기 위한 중요한 전제 조건은 추상화를 정확하게 다루는 능력이라는 것이 명확해진다   
> -- 키스 데블린(Keith Devlin)[Devlin 2003] 

<br>

### 추상화를 통한 복잡성 극복

추상화의 목적은 불필요한 부분을 무시함으로써 현실에 존재하는 복잡성을 극복하는 것이다  

추상화는 어떤 양상, 세부 사항, 구조를 좀 더 명확히 이해하기 위해 특정 절차나 물체를 의도적으로 생략하거나 감춤으로써 복잡도를 극복하는 방법이다  
복잡성을 다루기 위해 추상화는 두 차원에서 이뤄진다 `Kramer 2007`

1. 첫 번째 차원은 구체적인 사물들 간의 **공통점은 취하고 차이점은 버리는 일반화**를 통해 단순하게 만드는 것
2. 두 번째 차원은 중요한 부분을 강조하기 위해 **불필요한 세부 사항을 제거**함으로써 단순하게 만드는 것

<br>

### 객체지향과 추상화

'이상한 나라의 앨리스'에서 트럼프 카드처럼 생긴 하트 여왕의 행렬과 앨리스가 마주친 장면이 있다  

앨리스는 정원사들, 병사들, 왕자, 왕비 등 차이점을 무시하고 모든 객체를 `트럼프`라는 하나의 개념으로 단순화해서 바라봤다  
`트럼프`라고 했을때 떠오르는 행동 양식과 모습 등의 공통점만을 취해 단순화 한 것이다  
그들을 전부 트럼프라는 그룹으로 생각해서 **복잡성을 효과적으로 감소**시킨 것이다  

<br>

#### 개념 

사람들은 본능적으로 공통적인 특성을 기준으로 객체를 여러 그룹으로 묶어 동시에 다뤄야하는 가짓수를 줄임으로써 상황을 단순화하려고 노력한다  
이처럼 공통점을 기반으로 객체들을 묶기 위한 그릇을 `개념(concept)`이라고 한다  

개념을 이용하면 여러 그룹으로 `분류(classification)`할 수 있다  
각 객체는 특정한 개념을 표현하는 그룹의 일원으로 포함된다
객체는 특정한 개념을 적용할 수 있는 구체적인 사물을 의미한다, 개념이 객체에 적용됐을 때 객체를 개념의 `인스턴스(instance)`라고 한다  

개념은 특정한 객체가 어떤 그룹에 속할 것인지를 결정한다  
객체의 분류장치로서 개념을 이야기할 때는 세 가지 관점을 함께 언급한다

- 심볼(symbol) : 개념을 가리키는 간략한 이름이나 명칭
- 내연(intension) : 개념의 완전한 정의를 나타내며 내연의 의미를 이용해 객체가 개념에 속하는지 여부를 확인할 수 있다  
- 외연(extension) : 개념에 속하는 모든 객체의 집합(set)

`심볼`은 트럼프가 될 것이고, `내연`은 개념의 의미로 몸이 납작하고 두 손과 두발이 모서리에 붙어있는 등장인물인 것이다  
`외연`은 개념의 속하는 객체들로 정원사, 병사, 신하, 왕자와 공주, 하트 여왕이 외연을 구성하는 객체 집합에 속한다  

<br>

#### 객체를 분류하기 위한 틀

외연의 관점에서 어떤 객체에 어떤 개념을 적용할 수 있다는 것은 동일한 개념으로 구성된 객체 집합에 해당 객체를 포함시킨다는 것을 의미한다  

`분류`란 특정한 개념을 적용하는 작업이다  
객체에 특정한 개념을 적용하기로 결심했을 때 우리는 그 객체를 특정한 집합의 멤버로 분류하고 있는 것이다  

<br> 

### 타입

타입의 정의는 개념의 정의와 완전히 동일하다  
공통점을 기반으로 `객체들을 묶기 위한 틀`이다  

<br>

#### 데이터 타입

메모리 안에 저장된 종류를 분류하는데 사용하는 메모리 집합에 관한 메타데이터이다  
타입 시스템의 목적은 데이터가 잘못 사용되지 않도록 제약사항을 부과하는 것이다  

1. 타입은 데이터가 **어떻게 사용되느냐**에 관한 것이다
   - 어떤 데이터에 어떤 연산자를 적용할 수 있느냐가 그 데이터 타입을 결정한다는 점
2. 타입에 속한 데이터를 메모리에 어떻게 표현하는지는 **외부로부터 철저하게 감춰진다**
   - 개발자는 해당 데이터 타입에 표현방식을 몰라도 상관이 없고, 적용할 수 있는 연산자만 알고 있으면 된다  

<br>

#### 객체와 타입

객체를 일종의 데이터 처럼 사용해  
객체를 타입에 따라 분류하고 그 타입에 이름을 붙이는 것은 결국 프로그램에서 사용할 새로운 데이터 타입을 선언하는 것과 같다  

1. 어떤 객체가 어떤 타입에 속하는지를 결정하는 것은 **객체가 수행하는 행동**이다
   - 어떤 객체들이 동일한 행동을 수행할 수 있다면 그 객체들은 동일한 타입으로 분류될 수 있다
2. 객체의 내부적인 표현은 외부로부터 철저하게 **감춰진다**
   - 객체의 행동을 가장 효과적으로 수행할 수 있다면 객체 내부의 상태를 어떤 방식으로 표현하더라도 무방하다

<br>

#### 행동이 우선이다 

어떤 객체를 다른 객체와 동일한 타입으로 분류하는 기준은  
그 객체가 타입에 속한 다른 객체와 `동일한 행동`을 하기만 하면 된다  
다른 데이터를 가지고 있던 동일한 데이터 가지고 있던 **다른 행동을 한다면 서로 다른 타입으로 분류**되어야 한다  

같은 타입에 속한 객체는 행동만 동일하다면 서로 다른 데이터를 가질 수 있다  
동일한 행동은 동일한 책임을 의미하며, 동일한 책임은 동일한 메시지 수신을 의미한다  

결국 동일한 타입에 속한 객체는 내부 데이터 표현방식이 달라도 동일한 메시지를 수신하고 이를 처리할 수 있다  
다만 내부 표현 방식이 달라 동일한 메시지를 처리하는 방식은 서로 다를 수 밖에 없는데  
이것은 동일한 요청에 서로 다른 방식으로 응답할 수 있는 능력인 `다형성` 에 의미를 부여한다  

<br>

데이터의 내부 표현 방식과 무관하게 행동만이 고려 대상이라는 사실은 외부에 데이터를 감춰야 한다는 것을 의미한다  
훌륭한 객체지향 설계는 외부에 행동만을 제공하고 데이터는 행동 뒤로 감춰야 한다  
이 원칙을 흔히 `캡슐화`라고 한다  

행동에 따라 객체를 분류하기 위해서는 객체가 내부적으로 관리해야 하는 데이터가 아니라  
객체가 **외부에 제공해야 하는 행동**을 먼저 생각해야 한다  
이를 위해선 객체가 외부에 제공해야 하는 책임을 먼저 결정하고 그 책임을 수행하는 데 적합한 데이터를 나중에 결정한 후  
데이터를 책임을 수행하는데 필요한 외부 인터페이스 뒤로 캡슐화해야 한다  
`RDD(Responsibility-Driven Design)`는 `DDD(Data-Driven Design)`방법의 단점을 개선하기 위해 고안됐다  

<br>

### 타입의 계층

#### 트럼프 계층

객체가 동일한 타입으로 분류되려면 **공통의 행동**을 가져야만 한다  

우리가 아는 카드 게임용 트럼프와 앨리스가 봤던 트럼프인 트럼프 인간은 같지 않다고 볼 수 있다  
트럼프가 가지고 있는 행동을 트럼프 인간이 할 순 있지만  
트럼프 인간이 `걸을 때마다 몸이 종이처럼 좌우로 팔락거린다`는 행동은 일반 트럼프 카드가 하지 못하기 때문이다  

외연이라는 객체의 관점에서 트럼프 인간 타입에 속한 객체는 트럼프 타입의 객체에도 함께 속해야 한다는 것이다  
트럼프와 트럼프 인간 사이의 관계를 `일반화/특수화(generalization/specialization)` 관계라고 한다  

<br>

#### 일반화/특수화 관계

타입과 타입 사이에는 일반화/특수화 관계가 존재할 수 있다  
트럼프는 트럼프 인간보다 더 `일반`적이고, 트럼프 인간은 트럼프보다 더 `특수`하다  
일반적인 것은 더 포괄적인 것이며 특수하다는 것은 일반적인 개념보다 범위가 더 좁다는 것을 의미한다  

중요한 건 객체지향에서 일반화/특수화 관계를 결정하는 것은 객체의 상태를 표현하는 데이터가 아니라 **행동**이라는 것이다  

행동의 관점에서 일반적인 타입은 특수한 타입보다 더 적은 수의 행동을 가지고    
특수한 타입은 일반적인 타입보다 더 많은 수의 행동을 가진다  
단, 특수한 타입은 일반적인 타입이 할 수 있는 모든 행동을 동일하게 수행할 수 있어야 한다  

<br>

#### 슈퍼타입과 서브타입

일반화/특수화 관계는 좀 더 일반적인 한 타입과 좀 더 특수한 한 타입 간의 관계다  
좀 더 일반적인 타입을 `슈퍼타입(Supertype)`, 좀 더 특수한 타입을 `서브타입(Subtype)`이라고 한다  

다시 한 번 강조하지만  
슈퍼타입과 서브타입에서 중요한 것은 두 타입간의 관계가 행동에 의해 결정된다는 점이다  
어떤 타입이 다른 타입의 서브타입이 되기 위해서는 행위적 호환성을 만족시켜야 한다  
일반적으로 서브타입은 슈퍼타입의 행위와 호환되기 때문에 **서브타입은 슈퍼타입을 대체할 수 있어야 한다** `LSP`    
트럼프 인간이 트럼프를 대체할 수 있어야한다는 것이다  

<br>

#### 일반화는 추상화를 위한 도구다

추상화의 두 번째 차원은 중요한 부분을 강조하기 위해 불필요한 세부 사항을 제거시켜 `단순`하게 만드는 것이다  

앨리스는 등장인물들의 차이점을 배제하고 `공통점`만을 강조함으로써 이들을 공통의 타입인 트럼프 인간으로 분류했다  
또한 트럼프 인간을 좀 더 단순한 관점에서 바라보기 위해 `불필요한 특성`을 배제하고 좀 더 포괄적인 의미를 지닌 트럼프로 일반화했다  

객체지향 패러다임을 통해 세상을 바라보는 거의 대부분의 경우에 분류와 일반화/특수화 기법을 동시에 적용하게 된다  

<br>

### 정적 모델

#### 타입의 목적

타입을 사용하는 이유는 인간의 인지 능력으로는 시간에 따라 동적으로 변하는 객체의 복잡성을 극복하기가 너무 어렵기 때문이다  

앨리스의 키는 어떤 행동을 할 때마다 시시각각 변한다  
그렇기에 우리의 머릿속에 앨리스가 가질 수 있는 모든 경우의 키 값을 나열하는 대신  
앨리스의 키가 임의의 값을 가질 수 있다는 사실만을 생각함으로써 상황을 단순하게 만들 수 있다  
앨리스가 변경되는 키라는 상태를 가진다고 단순화하면 그만이라는 것이다  

따라서 타입은 시간에 따라 동적으로 변하는 앨리스의 상태를 시간과 무관한 정적인 모습으로 다룰 수 있게 해준다  

<br> 

#### 그래서 결국 타입은 추상화다  

앨리스에 관해 생각할 때 불필요한 시간이라는 요소와 상태 변화라는 요소를 제거하고  
철저하게 정적인 관점에서 앨리스의 모습을 묘사하는 것을 가능하게 해준다  

타입은 추상화이며 타입을 이용하면 객체의 동적인 특성을 추상화할 수 있다  
결국 타입은 시간에 따른 객체의 상태 변경이라는 복잡성을 `단순화`할 수 있는 효과적인 방법인 것이다  

<br>

#### 동적 모델과 정적 모델 

객체를 생각할 때 우리는 두 가지 모델을 동시에 고려한다는 사실을 알 수 있다  

하나는 객체가 특정 시점에 구체적으로 어떤 상태를 가지느냐다, 이는 객체의 `스냅샷(snapshot)[D'souze 1998]`이라고 한다  
객체지향 모델링을 위한 표준 언어안 `UML`에서 스냅샷은 `객체 다이어그램(object diagram)[Fowler 2003]`이라고도 불린다  
스냅샷처럼 실제로 객체가 살아 움직이는동안 상태가 어떻게 변하고 어떻게 행동하는지를 포착하는 것을 `동적 모델(dynamic model)`이라고 한다  

다른 하나는 객체가 가질 수 있는 모든 상태와 모든 행동을 시간에 독립적으로 표현하는 것이다  
일반적으로 이런 모델을 `타입 모델(type diagram)`이라고 한다  
이 모델은 동적으로 변하는 객체의 상태가 아니라 객체가 속한 타입의 정적인 모습을 표현하기 때문에 `정적 모델(static model)`이라고도 한다  

<br>

#### 클래스 

`OOP`에서 정적인 모델은 클래스를 이용해 구현된다  
따라서 **타입을 구현**하는 가장 보편적인 방법은 클래스를 이용하는 것이다  
클래스와 타입은 동일한 것이 아니다, 타입은 객체를 분류하기 위해 사용하는 개념이다  
반면 클래스는 단지 타입을 구현할 수 있는 여러 구현 메커니즘 중 하나일 뿐이다  

객체를 분류하는 기준은 타입이며, 타입을 나누는 기준은 객체가 수행하는 행동이라는 사실만을 기억하자  

결국 객체지향에서 중요한 것은 동적으로 변하는 객체의 `상태`와 상태를 변경하는 `행위`다







